<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>FastStile â€“ Economia Inteligente</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="./manifest.json">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --primary: #0d6efd;
  --success: #198754;
  --warning: #ffc107;
  --danger: #dc3545;
  --bg: #f4f6f8;
  --card: #fff;
}
.dark {
  --bg: #121212;
  --card: #1e1e1e;
  color: #fff;
}
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: var(--bg);
}
header {
  background: var(--primary);
  color: #fff;
  padding: 15px;
  text-align: center;
}
.card {
  background: var(--card);
  margin: 10px;
  padding: 15px;
  border-radius: 14px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, .1);
}
button, input, select {
  width: 100%;
  padding: 10px;
  margin: 5px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 15px;
}
button {
  background: var(--primary);
  color: #fff;
  border: none;
}
.kpis {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}
.kpi {
  text-align: center;
  padding: 10px;
  border-radius: 10px;
  background: #e9ecef;
}
.badge {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 20px;
  background: gold;
}
.alert {
  background: var(--danger);
  color: #fff;
  padding: 10px;
  border-radius: 10px;
}
</style>
</head>
<body>

<header>
  <h2>FastStile</h2>
  <small>Economia Inteligente</small>
</header>

<div id="app">

  <div class="card">
    <button onclick="toggleDark()">ğŸŒ™ Dark Mode</button>
  </div>

  <div class="card">
    <h3>ğŸ“Š Dashboard Inteligente</h3>
    <div class="kpis">
      <div class="kpi"><small>Renda</small><h3 id="renda"></h3></div>
      <div class="kpi"><small>Despesas</small><h3 id="desp"></h3></div>
      <div class="kpi"><small>Sobra</small><h3 id="sobra"></h3></div>
      <div class="kpi"><small>Status</small><h3 id="status"></h3></div>
    </div>
    <br>
    <div id="badge" class="badge hidden">ğŸ† Financeiro Exemplar</div>
    <div id="alerta" class="alert hidden"></div>
    <button onclick="resetApp()">â™»ï¸ Limpar / Refazer</button>
  </div>

  <div class="card"><canvas id="grafPizza"></canvas></div>
  <div class="card"><canvas id="grafBar"></canvas></div>

  <div class="card">
    <h3>ğŸ¯ Meta Mensal</h3>
    <input type="number" id="meta" placeholder="Valor da meta">
    <button onclick="salvarMeta()">Salvar Meta</button>
  </div>

  <div class="card">
    <h3>â• Nova Despesa</h3>
    <select id="cat">
      <option>DZ</option><option>AlimentaÃ§Ã£o + Feira</option><option>Internet</option>
      <option>Telefone</option><option>Moradia</option><option>INSS</option>
      <option>RemÃ©dio</option><option>Pet</option><option>CombustÃ­vel</option>
    </select>
    <input type="number" id="val" placeholder="Valor da despesa">
    <button onclick="addDespesa()">Adicionar</button>
  </div>

  <div class="card">
    <h3>ğŸ“ Dados</h3>
    <button onclick="exportCSV()">Exportar CSV</button>
    <input type="file" onchange="importCSV(event)">
    <button onclick="backup()">Backup Local</button>
    <input type="file" onchange="restore(event)">
  </div>

</div>

<script>
// PersistÃªncia
let data = JSON.parse(localStorage.getItem("faststileData")) || { renda:4299.22, meta:0, despesas:[] };

function saveLocal(){ localStorage.setItem("faststileData", JSON.stringify(data)); }

// Adicionar despesa
function addDespesa(){
  const valNum = +val.value;
  if(valNum>0) data.despesas.push({c:cat.value, v:valNum, data: Date.now()});
  val.value="";
  render();
  saveLocal();
}

// Salvar Meta
function salvarMeta(){
  data.meta = +meta.value;
  render();
  saveLocal();
}

// Reset total
function resetApp(){
  if(confirm("Limpar tudo e comeÃ§ar de novo?")){
    data = { renda:4299.22, meta:0, despesas:[] };
    saveLocal();
    render();
  }
}

// Render dashboard
function render(){
  const total = data.despesas.reduce((a,b)=>a+b.v,0);
  const sobra = data.renda - total;

  renda.innerText = `R$ ${data.renda.toFixed(2)}`;
  desp.innerText = `R$ ${total.toFixed(2)}`;
  sobra.innerText = `R$ ${sobra.toFixed(2)}`;

  let statusTxt = "OK";
  alerta.classList.add("hidden");

  if(data.meta && sobra < data.meta){
    statusTxt = "Meta em risco";
    alerta.innerText = "âš ï¸ VocÃª estÃ¡ abaixo da meta!";
    alerta.classList.remove("hidden");
  }
  if(sobra < 0) statusTxt = "PrejuÃ­zo";
  status.innerText = statusTxt;

  badge.classList.toggle("hidden", sobra < 1000);

  const map = {};
  data.despesas.forEach(x=>map[x.c] = (map[x.c] || 0) + x.v);

  if(window.chartPizza) window.chartPizza.destroy();
  if(window.chartBar) window.chartBar.destroy();

  window.chartPizza = new Chart(grafPizza, { type:"pie", data:{labels: Object.keys(map), datasets:[{data:Object.values(map)}]} });
  window.chartBar = new Chart(grafBar, { type:"bar", data:{labels:Object.keys(map), datasets:[{data:Object.values(map)}]} });
}

// CSV / Backup
function exportCSV(){ let csv="Categoria,Valor\n"; data.despesas.forEach(x=>csv+=`${x.c},${x.v}\n`); download(csv,"faststile.csv"); }
function importCSV(e){
 const r=new FileReader();
 r.onload=()=>{ r.result.split("\n").slice(1).forEach(l=>{ const [c,v]=l.split(","); if(c&&v) data.despesas.push({c,v:+v,data:Date.now()}); render(); saveLocal(); }); };
 r.readAsText(e.target.files[0]);
}
function backup(){ download(JSON.stringify(data),"faststile-backup.json"); }
function restore(e){ const r=new FileReader(); r.onload=()=>{ data=JSON.parse(r.result); saveLocal(); render(); }; r.readAsText(e.target.files[0]); }
function download(content,name){ const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([content])); a.download=name; a.click(); }

// Dark Mode
function toggleDark(){ document.body.classList.toggle("dark"); }

// Service Worker (PWA)
if("serviceWorker" in navigator){ navigator.serviceWorker.register("./sw.js"); }

// Inicia render
render();
</script>

</body>
</html>